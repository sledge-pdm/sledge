## ストローク描画最適化案の分類

- Safe（UXを損なわず速度改善）
  - pointerrawupdate を対応ブラウザで使い、非対応は pointermove にフォールバック（入力サンプルは破棄しない）。
  - rAF 内でイベントを全てキューし、getCoalescedEvents も含め「受け取ったサンプルを捨てずにまとめて処理」し、描画だけフレーム終端1回にする。
  - 非描画時の早期 return、カーソル/ストア更新の抑制（不要処理削減のみ）。
  - shape spans や centerPosition のキャッシュ化、pixelAcc をビットセット/TypedArray 化（同一計算や文字列 Map のオーバーヘッド排除）。
  - 履歴登録は End/Cancel 時にまとめて flush（描画結果は保持し、履歴処理のみ遅延）。
  - putShape/putShapeLine をワーカーや Rust にオフロード（処理場所を変えるだけで機能等価）。

- Euclid（サンプルを一部捨てたり、更新感が環境で変わる可能性あり）
  - rAF に合わせる際に「最新1点のみ採用」や「一定間隔で古いサンプルを破棄」する集約。
  - 適応型スロットル/デバウンスで負荷が高い時だけイベント処理頻度を下げる（滑らかさが環境依存で揺れる）。
  - rAF 固定で 60fps 上限にするなど、高リフレッシュ環境でポインタ追従間隔が粗くなる設定。

- Keter（不可逆な破壊や更新機会喪失が確実に起きうる）
  - 固定レートを強く下げる（例: 30fps に固定）など、速度が速いストロークでサンプル欠落が顕在化する設定。

## 最初に着手する Safe タスク（1・2）

- 非描画時の早期 return とカーソル/ストア更新抑制  
  - 目的: 無関係なポインタ移動での setInteractStore/setCursor をスキップし、ホットパスの負荷を削る。  
  - 方針: `isDrawableClick` 等の判定を前倒しし、無効時はストア更新・カーソル変更・ログを実行しない。

- デバッグ計測・詳細ログをフラグ下に限定  
  - 目的: `new Date()` 計測や文字列整形のコストを常時発生させない。  
  - 方針: 既存のデバッグフラグ（例: `VERBOSE_LOG_ENABLED` 等）でガードするか、ローカルな `if (debug)` で包み、通常パスでは発火させない。
